//- views/index.pug
extends layout/layout

block content
  .container-fluid.py-4
    .row.mb-4
      .col
        h1.fw-bold.mb-1 Dashboard general
        p.text-muted Monitoreá la operación diaria de Eventify de un vistazo.

    .row.g-4
      each card in metricCards
        .col-sm-6.col-xl-3
          .card.shadow-sm.border-0.h-100
            .card-body
              .d-flex.justify-content-between.align-items-start
                div
                  h2.fw-bold.mb-0= card.value
                  p.text-muted.mb-0= card.subtitle
                span.badge.rounded-pill(class='bg-' + card.color)
                  i.bi(class='bi-' + card.icon)
              h6.text-uppercase.small.text-muted.mt-3= card.label

    .row.g-4.mt-2
      .col-lg-7
        .card.shadow-sm.border-0.h-100
          .card-header.bg-transparent.border-0.d-flex.justify-content-between.align-items-center
            h5.mb-0 Próximos eventos
            a.small.text-decoration-none(href="/eventos") Ver todos
          .card-body.p-0
            if eventosProximos && eventosProximos.length
              .table-responsive
                table.table.align-middle.mb-0
                  thead.table-light
                    tr
                      th Evento
                      th Cliente
                      th Inicio
                      th Estado
                  tbody
                    each evento in eventosProximos
                      tr
                        td.fw-semibold= evento.nombre
                        td= evento.clienteNombre
                        td
                          if evento.fechaInicioLabel && evento.fechaInicioLabel !== 'Sin fecha'
                            span= evento.fechaInicioLabel
                            br
                            if evento.horaInicioLabel
                              small.text-muted= evento.horaInicioLabel
                          else
                            span.text-muted Sin fecha
                        td
                          span.badge(class=evento.badgeClass)= evento.estado || 'planificacion'
            else
              .p-4.text-center.text-muted
                i.bi.bi-emoji-smile-upside-down.fs-3.d-block.mb-2
                span No hay eventos próximos en agenda

      .col-lg-5
        .card.shadow-sm.border-0.h-100
          .card-header.bg-transparent.border-0
            h5.mb-0 Estado de tareas
          .card-body
            if totalTareas > 0
              .mb-3
                .d-flex.justify-content-between.align-items-center.mb-1
                  span.small.text-muted Pendientes
                  span.small.fw-semibold= tareasPorEstado.pendiente
                .progress.progress-sm
                  .progress-bar.bg-warning(style='width: ' + tareasPorEstadoPercent.pendiente + '%')
              .mb-3
                .d-flex.justify-content-between.align-items-center.mb-1
                  span.small.text-muted En proceso
                  span.small.fw-semibold= tareasPorEstado.enProceso
                .progress.progress-sm
                  .progress-bar.bg-info(style='width: ' + tareasPorEstadoPercent.enProceso + '%')
              .mb-3
                .d-flex.justify-content-between.align-items-center.mb-1
                  span.small.text-muted Finalizadas
                  span.small.fw-semibold= tareasPorEstado.finalizada
                .progress.progress-sm
                  .progress-bar.bg-success(style='width: ' + tareasPorEstadoPercent.finalizada + '%')
            else
              .p-3.text-center.text-muted
                span No hay tareas registradas

            hr
            h6.fw-semibold.mb-3 Tareas recientes
            if tareasRecientes && tareasRecientes.length
              ul.list-group.list-group-flush
                each tarea in tareasRecientes
                  li.list-group-item.px-0
                    .d-flex.justify-content-between.align-items-start
                      div
                        strong.d-block= tarea.titulo
                        small.text-muted= tarea.fechaLabel
                      span.badge(class=tarea.badgeClass)= tarea.estado || 'pendiente'
            else
              .text-muted.small No hay tareas para mostrar

    .row.g-4.mt-1
      .col-lg-6
        .card.shadow-sm.border-0
          .card-header.bg-transparent.border-0
            h5.mb-0 Distribución de eventos
          .card-body
            if totalEstados > 0
              each estado in distribucionEventos
                if estado.cantidad > 0
                  .mb-3
                    .d-flex.justify-content-between.align-items-center.mb-1
                      span
                        span.badge.me-2(class=estado.badgeClass)= estado.cantidad
                        span= estado.label
                      span.small.text-muted= estado.porcentaje + '%'
                    .progress.progress-sm
                      .progress-bar(class='bg-' + estado.color, style='width: ' + estado.porcentaje + '%')
            else
              .text-muted No hay eventos registrados

      .col-lg-6
        .card.shadow-sm.border-0
          .card-header.bg-transparent.border-0
            h5.mb-0 Accesos rápidos
          .card-body
            .row.g-3
              each acceso in accesosRapidos
                .col-sm-6
                  a.btn.w-100.border.d-flex.align-items-center.justify-content-between.py-3.px-3(class='btn-outline-' + acceso.color, href=acceso.route)
                    span
                      i.bi(class='bi-' + acceso.icon + ' me-2')
                      strong= acceso.label
                    i.bi.bi-arrow-right